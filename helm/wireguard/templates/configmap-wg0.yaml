{{- define "wg-config-template" -}}
{{- $natSourceNetOption := .Values.wireguard.natAddSourceNet | ternary (printf "%s %s" "-s" .Values.wireguard.serverCidr) ("") -}}
[Interface]
PrivateKey = GDS/UBb/R3FGtNdxjb2QFgbWoEr0peAKG1hEKLSSlGY=
Address = {{ .Values.wireguard.serverAddress }}
ListenPort = 51820
PostUp = iptables -t nat -A POSTROUTING {{ $natSourceNetOption }} -o eth0 -j MASQUERADE
PostDown = iptables -t nat -D POSTROUTING -s {{ $natSourceNetOption }} -o eth0 -j MASQUERADE

# Clients

# End Clients
kind: Secret
apiVersion: v1
metadata:
  name: "configmap-wg0"
data:
  wg0.conf: {{ include "wg-config-template" . | b64enc }}
{{- end }}

